<%- include('../partials/header') %>

<!-- Enhanced Checkout Section with 3-Step Process -->
<section class="min-h-screen bg-neutral-50 py-8">
  <div class="container mx-auto px-4">
    <div class="max-w-4xl mx-auto">

      <!-- Checkout Header - Optimized -->
      <div class="text-center mb-8">
        <h1 class="text-2xl md:text-3xl font-semibold text-neutral-900 mb-2">
          üõí Checkout
        </h1>
        <p class="text-neutral-600 text-sm">
          Complete your order with secure Mobile Money payment
        </p>
      </div>

      <!-- 3-Step Progress Indicator -->
      <div class="bg-white rounded-xl shadow-sm p-4 mb-6 border border-neutral-200">
        <div class="flex items-center justify-center">
          <div class="flex items-center space-x-4">
            <!-- Step 1: Cart Review -->
            <div class="flex items-center">
              <div class="w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center text-sm font-semibold">
                1
              </div>
              <span class="ml-2 text-sm font-medium text-primary">Cart Review</span>
            </div>

            <!-- Connector Line -->
            <div class="w-8 h-px bg-neutral-300"></div>

            <!-- Step 2: Shipping & Details -->
            <div class="flex items-center">
              <div class="w-8 h-8 bg-neutral-300 text-neutral-600 rounded-full flex items-center justify-center text-sm font-semibold">
                2
              </div>
              <span class="ml-2 text-sm font-medium text-neutral-600">Shipping & Details</span>
            </div>

            <!-- Connector Line -->
            <div class="w-8 h-px bg-neutral-300"></div>

            <!-- Step 3: Payment Confirmation -->
            <div class="flex items-center">
              <div class="w-8 h-8 bg-neutral-300 text-neutral-600 rounded-full flex items-center justify-center text-sm font-semibold">
                3
              </div>
              <span class="ml-2 text-sm font-medium text-neutral-600">Payment Confirmation</span>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Order Summary - Optimized -->
        <div class="bg-white rounded-xl shadow-sm p-6 border border-neutral-200">
          <h2 class="text-lg font-semibold text-neutral-900 mb-4 flex items-center gap-2">
            <span class="text-xl">üì¶</span>
            Order Summary
          </h2>

          <% if (cart && cart.items.length > 0) { %>
            <div class="space-y-3 mb-4">
              <% cart.items.forEach(item => { %>
                <div class="flex items-center justify-between p-3 bg-neutral-50 rounded-lg">
                  <div class="flex-1">
                    <h4 class="text-sm font-medium text-neutral-900 line-clamp-1">
                      <%= item.product.name %>
                    </h4>
                    <p class="text-xs text-neutral-600">
                      Qty: <%= item.quantity %>
                    </p>
                  </div>
                  <div class="text-right">
                    <p class="text-sm font-semibold text-primary">
                      <%= item.product.price * item.quantity %> RWF
                    </p>
                  </div>
                </div>
              <% }); %>
            </div>

            <div class="border-t border-neutral-200 pt-4">
              <div class="flex items-center justify-between">
                <span class="text-base font-semibold text-neutral-900">
                  Total:
                </span>
                <span class="text-xl font-bold text-rwanda-yellow">
                  <%= cart.total %> RWF
                </span>
              </div>
            </div>
          <% } else { %>
            <div class="text-center py-8">
              <p class="text-neutral-600 mb-4">Your cart is empty.</p>
              <a href="/products" class="btn-rwanda text-sm px-4 py-2">
                Continue Shopping
              </a>
            </div>
          <% } %>
        </div>

        <!-- Checkout Form - Optimized -->
        <div class="bg-white rounded-xl shadow-sm p-6 border border-neutral-200">
          <h2 class="text-lg font-semibold text-neutral-900 mb-4 flex items-center gap-2">
            <span class="text-xl">üìã</span>
            Complete Your Order
          </h2>

          <% if (typeof error !== 'undefined' && error) { %>
            <div class="bg-error-50 border border-error-200 text-error-700 px-3 py-2 rounded-lg mb-4 text-sm">
              ‚ö†Ô∏è <%= error %>
            </div>
          <% } %>

          <form action="/orders/process-checkout" method="POST" class="space-y-6">
            <!-- Shipping Information - Compact -->
            <div>
              <h3 class="text-base font-medium text-neutral-900 mb-3 flex items-center gap-2">
                <span class="text-lg">üöö</span>
                Shipping Information
              </h3>

              <div class="space-y-3">
                <div>
                  <label for="address" class="block text-sm font-medium text-neutral-700 mb-1">Street Address *</label>
                  <input type="text"
                         id="address"
                         name="shippingAddress[address]"
                         placeholder="Enter your street address"
                         class="form-input-rwanda w-full"
                         required>
                </div>

                <div class="grid grid-cols-2 gap-3">
                  <div>
                    <label for="city" class="block text-sm font-medium text-neutral-700 mb-1">City *</label>
                    <input type="text"
                           id="city"
                           name="shippingAddress[city]"
                           placeholder="Enter city"
                           class="form-input-rwanda w-full"
                           required>
                  </div>

                  <div>
                    <label for="country" class="block text-sm font-medium text-neutral-700 mb-1">Country *</label>
                    <select id="country" name="shippingAddress[country]" class="form-input-rwanda w-full" required>
                      <option value="">Select Country</option>
                      <option value="Rwanda" selected>Rwanda</option>
                      <option value="Kenya">Kenya</option>
                      <option value="Uganda">Uganda</option>
                      <option value="Tanzania">Tanzania</option>
                      <option value="Burundi">Burundi</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Payment Information - Compact -->
            <div>
              <h3 class="text-base font-medium text-neutral-900 mb-3 flex items-center gap-2">
                <span class="text-lg">üí≥</span>
                Payment Information
              </h3>

              <div class="space-y-3">
                <div>
                  <label class="block text-sm font-medium text-neutral-700 mb-2">Payment Method</label>
                  <div class="flex items-center gap-2">
                    <input type="radio" name="paymentMethod" value="mobile-money" checked id="mobile-money" class="text-primary focus:ring-primary">
                    <label for="mobile-money" class="text-sm text-neutral-700">
                      üì± Mobile Money (MTN/Airtel)
                    </label>
                  </div>
                </div>

                <div>
                  <label for="phoneNumber" class="block text-sm font-medium text-neutral-700 mb-1">Mobile Money Number *</label>
                  <input type="tel"
                         id="phoneNumber"
                         name="phoneNumber"
                         placeholder="e.g., 0788123456"
                         class="form-input-rwanda w-full"
                         pattern="^(\+250|0)[7-9][0-9]{8}$"
                         title="Enter valid Rwandan phone number"
                         required>
                  <p class="text-xs text-neutral-500 mt-1">
                    üí° We'll send a payment request to this number
                  </p>
                </div>
              </div>
            </div>

            <!-- Order Notes - Compact -->
            <div>
              <label for="notes" class="block text-sm font-medium text-neutral-700 mb-1">Order Notes (Optional)</label>
              <textarea id="notes"
                        name="notes"
                        placeholder="Any special delivery instructions..."
                        class="form-input-rwanda w-full"
                        rows="2"></textarea>
            </div>

            <!-- Terms and Conditions - Compact -->
            <div>
              <label class="flex items-start gap-2 cursor-pointer text-sm">
                <input type="checkbox" required class="mt-0.5 text-primary focus:ring-primary">
                <span class="text-neutral-700">
                  I agree to the <a href="/terms" class="text-primary hover:text-primary-600">Terms of Service</a>
                  and <a href="/privacy" class="text-primary hover:text-primary-600">Privacy Policy</a>
                </span>
              </label>
            </div>

            <button type="submit" class="btn-rwanda w-full text-base py-3">
              üí≥ Proceed to Payment
            </button>
          </form>

          <!-- Security Badges - Compact -->
          <div class="mt-4 p-3 bg-success-50 border border-success-200 rounded-lg">
            <div class="flex items-center justify-center gap-2">
              <span class="text-base">üîí</span>
              <div class="text-center">
                <p class="text-sm font-medium text-success-700">Secure Payment</p>
                <p class="text-xs text-success-600">SSL Encrypted ‚Ä¢ Mobile Money Protected</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<%- include('../partials/footer') %>