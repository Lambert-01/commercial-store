<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="<%= (typeof title !== 'undefined' && title) ? title + ' - ' : '' %>Ecommerce Rwanda - Premier multi-vendor marketplace connecting customers with local suppliers across Rwanda">
  <meta name="keywords" content="Rwanda, ecommerce, marketplace, shopping, local suppliers, Kigali, MTN Mobile Money, Airtel Money, online shopping">
  <meta name="author" content="Ecommerce Rwanda">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="<%= (typeof title !== 'undefined' && title) ? title : 'Ecommerce Rwanda - Multi-Vendor Marketplace' %>">
  <meta property="og:description" content="Discover amazing products from local Rwandan suppliers. Shop with confidence using MTN Mobile Money and Airtel Money.">
  <meta property="og:url" content="https://ecommercerwanda.com">
  <meta property="og:site_name" content="Ecommerce Rwanda">
  <meta property="og:image" content="/images/logo.png">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" content="<%= (typeof title !== 'undefined' && title) ? title : 'Ecommerce Rwanda - Multi-Vendor Marketplace' %>">
  <meta property="twitter:description" content="Discover amazing products from local Rwandan suppliers">
  <meta property="twitter:image" content="/images/logo.png">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">

  <title><%= (typeof title !== 'undefined' && title) ? title : 'Ecommerce Rwanda - Multi-Vendor Marketplace' %></title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/tailwind.css">
  <link rel="stylesheet" href="/css/admin.css">

  <!-- Animation Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css">

  <!-- Additional Animation Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.3.1/css/hover-min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

  <!-- Additional Meta for SEO -->
  <meta name="robots" content="index, follow">
  <meta name="language" content="English">
  <meta name="geo.region" content="RW">
  <meta name="geo.placename" content="Kigali, Rwanda">
</head>
<body class="bg-neutral-50">
  <!-- Enhanced Header with Search and Better Navigation -->
  <header class="bg-white shadow-sm border-b border-neutral-200 sticky top-0 z-50">
    <!-- Top Bar -->
    <div class="bg-primary text-white text-center py-2 text-sm">
      <div class="container mx-auto px-4">
        <span class="flex items-center justify-center gap-2">
          <span class="animate-pulse">🇷🇼</span>
          Free shipping on orders over 50,000 RWF | 📱 Pay with MTN & Airtel Money
          <span class="animate-pulse">🇷🇼</span>
        </span>
      </div>
    </div>

    <!-- Main Header -->
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between py-4">
        <!-- Logo -->
        <a href="/" class="flex items-center gap-3 text-neutral-900 hover:scale-105 transition-all duration-200">
          <div class="w-12 h-12 bg-gradient-to-br from-primary to-primary-600 rounded-xl flex items-center justify-center text-white text-xl font-bold shadow-lg">
            🇷🇼
          </div>
          <div>
            <h1 class="text-xl md:text-2xl font-bold text-neutral-900">Ecommerce Rwanda</h1>
            <p class="text-xs text-neutral-600 hidden sm:block">Multi-Vendor Marketplace</p>
          </div>
        </a>

        <!-- Search Bar - Hidden on homepage -->
        <% if (typeof currentRoute === 'undefined' || currentRoute !== 'home') { %>
        <div class="hidden md:flex flex-1 max-w-md mx-8">
          <div class="relative w-full">
            <input type="text"
                   id="searchInput"
                   placeholder="Search products, suppliers..."
                   class="w-full pl-10 pr-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-200">
            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400">🔍</span>
            <button onclick="performSearch()"
                    class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-primary text-white px-3 py-1 rounded-md text-sm hover:bg-primary-600 transition-colors duration-200">
              Search
            </button>
          </div>
        </div>
        <% } %>

        <!-- Desktop Navigation -->
        <nav class="hidden lg:flex items-center" role="navigation" aria-label="Main navigation">
          <ul class="flex items-center gap-1">
            <li>
              <a href="/"
                 class="flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'home') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                <span class="<%= (typeof currentRoute !== 'undefined' && currentRoute === 'home') ? 'text-white' : 'text-neutral-600' %>">🏠</span>
                <span class="font-medium">Home</span>
              </a>
            </li>
            <li>
              <a href="/products"
                 class="flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'products') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                <span class="<%= (typeof currentRoute !== 'undefined' && currentRoute === 'products') ? 'text-white' : 'text-neutral-600' %>">🛍️</span>
                <span class="font-medium">Products</span>
              </a>
            </li>
            <li>
              <a href="/suppliers"
                 class="flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'suppliers') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                <span class="<%= (typeof currentRoute !== 'undefined' && currentRoute === 'suppliers') ? 'text-white' : 'text-neutral-600' %>">🏪</span>
                <span class="font-medium">Suppliers</span>
              </a>
            </li>
            <li>
              <a href="/cart"
                 class="relative flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'cart') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                <span class="<%= (typeof currentRoute !== 'undefined' && currentRoute === 'cart') ? 'text-white' : 'text-neutral-600' %>">🛒</span>
                <span class="font-medium">Cart</span>
                <% if (typeof cartItemCount !== 'undefined' && cartItemCount > 0) { %>
                  <span class="absolute -top-1 -right-1 bg-secondary text-neutral-900 text-xs font-bold px-2 py-1 rounded-full animate-bounce">
                    <%= cartItemCount %>
                  </span>
                <% } %>
              </a>
            </li>

            <% if (isAuthenticated) { %>
              <!-- Customer Navigation -->
              <% if (isSupplier !== true && isAdmin !== true) { %>
                <li>
                  <a href="/orders/history"
                     class="flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'orders') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                    <span class="<%= (typeof currentRoute !== 'undefined' && currentRoute === 'orders') ? 'text-white' : 'text-neutral-600' %>">📋</span>
                    <span class="font-medium">My Orders</span>
                  </a>
                </li>
              <% } %>

              <!-- Supplier Navigation -->
              <% if (isSupplier) { %>
                <li>
                  <a href="/supplier/dashboard"
                     class="flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'supplier') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                    <span class="<%= (typeof currentRoute !== 'undefined' && currentRoute === 'supplier') ? 'text-white' : 'text-neutral-600' %>">🏪</span>
                    <span class="font-medium">Supplier</span>
                  </a>
                </li>
                <li>
                  <a href="/supplier/orders"
                     class="flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'supplier-orders') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                    <span class="<%= (typeof currentRoute !== 'undefined' && currentRoute === 'supplier-orders') ? 'text-white' : 'text-neutral-600' %>">📦</span>
                    <span class="font-medium">My Orders</span>
                  </a>
                </li>
              <% } %>

              <!-- Admin Navigation -->
              <% if (isAdmin) { %>
                <li>
                  <a href="/admin-portal"
                     class="flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'admin') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                    <span class="<%= (typeof currentRoute !== 'undefined' && currentRoute === 'admin') ? 'text-white' : 'text-neutral-600' %>">⚙️</span>
                    <span class="font-medium">Admin</span>
                  </a>
                </li>
              <% } %>

              <!-- User Menu -->
              <li class="relative group">
                <button class="flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 text-neutral-700 hover:bg-neutral-100">
                  <span>👤</span>
                  <span class="font-medium"><%= typeof user !== 'undefined' && user.name ? user.name : 'User' %></span>
                  <span class="text-neutral-400">▼</span>
                </button>
                <div class="absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-lg border border-neutral-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                  <div class="py-2">
                    <div class="px-4 py-2 border-b border-neutral-200">
                      <p class="text-sm font-medium text-neutral-900"><%= typeof user !== 'undefined' && user.name ? user.name : 'User' %></p>
                      <p class="text-xs text-neutral-600"><%= typeof user !== 'undefined' && user.email ? user.email : '' %></p>
                      <span class="inline-flex items-center gap-1 mt-1">
                        <span class="w-2 h-2 bg-primary rounded-full"></span>
                        <span class="text-xs text-primary font-medium">
                          <%= typeof user !== 'undefined' && user.role ? user.role.charAt(0).toUpperCase() + user.role.slice(1) : 'Customer' %>
                        </span>
                      </span>
                    </div>

                    <!-- Customer Menu Items -->
                    <% if (isSupplier !== true && isAdmin !== true) { %>
                      <a href="/profile" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">👤 My Profile</a>
                      <a href="/orders/history" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">📋 Order History</a>
                    <% } %>

                    <!-- Supplier Menu Items -->
                    <% if (isSupplier) { %>
                      <a href="/profile" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">👤 My Profile</a>
                      <a href="/supplier/dashboard" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">🏪 Supplier Dashboard</a>
                      <a href="/supplier/products" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">📦 My Products</a>
                      <a href="/supplier/orders" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">📋 Customer Orders</a>
                      <a href="/supplier/store" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">🏪 Store Settings</a>
                    <% } %>

                    <!-- Admin Menu Items -->
                    <% if (isAdmin) { %>
                      <a href="/profile" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">👤 My Profile</a>
                      <a href="/admin-portal" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">⚙️ Admin Portal</a>
                      <a href="/admin-portal/users" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">👥 User Management</a>
                      <a href="/admin-portal/products" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">📦 Product Management</a>
                    <% } %>

                    <div class="border-t border-neutral-200 mt-2 pt-2">
                      <a href="/logout" class="block px-4 py-2 text-sm text-error hover:bg-error hover:bg-opacity-10">🚪 Logout</a>
                    </div>
                  </div>
                </div>
              </li>
            <% } else { %>
              <li>
                <a href="/login"
                   class="flex items-center gap-2 px-4 py-3 rounded-lg transition-all duration-200 text-neutral-700 hover:bg-neutral-100">
                  <span>🔑</span>
                  <span class="font-medium">Login</span>
                </a>
              </li>
              <li>
                <a href="/register"
                   class="btn-rwanda text-sm px-6 py-3">
                  📝 Register
                </a>
              </li>
            <% } %>
          </ul>
        </nav>

        <!-- Right Side Actions -->
        <div class="flex items-center gap-3">
          <!-- Mobile Search Toggle - Hidden on homepage -->
          <% if (typeof currentRoute === 'undefined' || currentRoute !== 'home') { %>
          <button id="mobileSearchToggle" class="md:hidden text-neutral-600 hover:text-primary p-2">
            🔍
          </button>
          <% } %>

          <!-- Cart Icon (Mobile) -->
          <a href="/cart" class="relative text-neutral-600 hover:text-primary transition-colors duration-200">
            <span class="text-2xl">🛒</span>
            <% if (typeof cartItemCount !== 'undefined' && cartItemCount > 0) { %>
              <span class="absolute -top-1 -right-1 bg-secondary text-neutral-900 text-xs font-bold px-2 py-1 rounded-full animate-pulse">
                <%= cartItemCount %>
              </span>
            <% } %>
          </a>

          <!-- Mobile menu toggle -->
          <button id="mobileMenuToggle" class="lg:hidden text-neutral-600 hover:text-primary text-2xl p-2" aria-label="Toggle navigation menu">
            ☰
          </button>
        </div>
      </div>

      <!-- Mobile Search Bar - Hidden on homepage -->
      <% if (typeof currentRoute === 'undefined' || currentRoute !== 'home') { %>
      <div id="mobileSearch" class="md:hidden hidden pb-4">
        <div class="relative">
          <input type="text"
                 id="mobileSearchInput"
                 placeholder="Search products..."
                 class="w-full pl-10 pr-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
          <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400">🔍</span>
        </div>
      </div>
      <% } %>
    </div>

    <!-- Mobile Navigation Menu -->
    <div id="mobileMenu" class="lg:hidden hidden bg-white border-t border-neutral-200">
      <div class="container mx-auto px-4 py-4">
        <nav role="navigation" aria-label="Mobile navigation">
          <ul class="space-y-2">
            <li>
              <a href="/" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'home') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                <span>🏠</span>
                <span class="font-medium">Home</span>
              </a>
            </li>
            <li>
              <a href="/products" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'products') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                <span>🛍️</span>
                <span class="font-medium">Products</span>
              </a>
            </li>
            <li>
              <a href="/suppliers" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'suppliers') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                <span>🏪</span>
                <span class="font-medium">Suppliers</span>
              </a>
            </li>
            <li>
              <a href="/cart" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'cart') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                <span>🛒</span>
                <span class="font-medium">Cart</span>
                <% if (typeof cartItemCount !== 'undefined' && cartItemCount > 0) { %>
                  <span class="bg-secondary text-neutral-900 px-2 py-1 rounded-full text-xs font-bold ml-auto">
                    <%= cartItemCount %>
                  </span>
                <% } %>
              </a>
            </li>

            <% if (isAuthenticated) { %>
              <!-- Customer Mobile Navigation -->
              <% if (isSupplier !== true && isAdmin !== true) { %>
                <li>
                  <a href="/orders/history" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'orders') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                    <span>📋</span>
                    <span class="font-medium">My Orders</span>
                  </a>
                </li>
              <% } %>

              <!-- Supplier Mobile Navigation -->
              <% if (isSupplier) { %>
                <li>
                  <a href="/supplier/dashboard" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'supplier') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                    <span>🏪</span>
                    <span class="font-medium">Supplier Dashboard</span>
                  </a>
                </li>
                <li>
                  <a href="/supplier/orders" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'supplier-orders') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                    <span>📦</span>
                    <span class="font-medium">Customer Orders</span>
                  </a>
                </li>
              <% } %>

              <!-- Admin Mobile Navigation -->
              <% if (isAdmin) { %>
                <li>
                  <a href="/admin-portal" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 <%= (typeof currentRoute !== 'undefined' && currentRoute === 'admin') ? 'bg-primary text-white' : 'text-neutral-700 hover:bg-neutral-100' %>">
                    <span>⚙️</span>
                    <span class="font-medium">Admin Portal</span>
                  </a>
                </li>
              <% } %>

              <!-- Common Mobile Navigation -->
              <li>
                <a href="/profile" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 text-neutral-700 hover:bg-neutral-100">
                  <span>👤</span>
                  <span class="font-medium">My Profile</span>
                </a>
              </li>
              <li>
                <a href="/logout" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 text-error hover:bg-error hover:bg-opacity-10">
                  <span>🚪</span>
                  <span class="font-medium">Logout</span>
                </a>
              </li>
            <% } else { %>
              <li>
                <a href="/login" class="flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 text-neutral-700 hover:bg-neutral-100">
                  <span>🔑</span>
                  <span class="font-medium">Login</span>
                </a>
              </li>
              <li>
                <a href="/register" class="btn-rwanda w-full text-center py-3">
                  📝 Register
                </a>
              </li>
            <% } %>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <!-- AOS Animation Library Script -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <!-- Search and Mobile Menu JavaScript -->
  <script>
    // Mobile menu toggle
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuToggle = document.getElementById('mobileMenuToggle');
      const mobileMenu = document.getElementById('mobileMenu');
      const mobileSearchToggle = document.getElementById('mobileSearchToggle');
      const mobileSearch = document.getElementById('mobileSearch');

      // Mobile menu toggle
      if (mobileMenuToggle && mobileMenu) {
        mobileMenuToggle.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
          mobileMenu.classList.toggle('block');

          // Update button icon
          const isOpen = !mobileMenu.classList.contains('hidden');
          mobileMenuToggle.innerHTML = isOpen ? '✕' : '☰';
        });
      }

      // Mobile search toggle
      if (mobileSearchToggle && mobileSearch) {
        mobileSearchToggle.addEventListener('click', function() {
          mobileSearch.classList.toggle('hidden');
          mobileSearch.classList.toggle('block');

          if (!mobileSearch.classList.contains('hidden')) {
            document.getElementById('mobileSearchInput').focus();
          }
        });
      }

      // Search functionality
      const searchInput = document.getElementById('searchInput');
      const mobileSearchInput = document.getElementById('mobileSearchInput');

      function performSearch() {
        const query = searchInput ? searchInput.value.trim() : '';
        const mobileQuery = mobileSearchInput ? mobileSearchInput.value.trim() : '';

        const searchQuery = query || mobileQuery;
        if (searchQuery) {
          window.location.href = `/products?search=${encodeURIComponent(searchQuery)}`;
        }
      }

      // Search on Enter key
      if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            performSearch();
          }
        });
      }

      if (mobileSearchInput) {
        mobileSearchInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            performSearch();
          }
        });
      }

      // Close mobile menu when clicking outside
      document.addEventListener('click', function(e) {
        if (mobileMenu && !mobileMenu.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
          mobileMenu.classList.add('hidden');
          mobileMenu.classList.remove('block');
          if (mobileMenuToggle) mobileMenuToggle.innerHTML = '☰';
        }

        if (mobileSearch && !mobileSearch.contains(e.target) && !mobileSearchToggle.contains(e.target)) {
          mobileSearch.classList.add('hidden');
          mobileSearch.classList.remove('block');
        }
      });
    });
  </script>

  <main class="min-h-screen bg-neutral-50">
    <div class="container mx-auto px-4 py-6">